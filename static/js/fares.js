// Generated by CoffeeScript 1.6.3
jQuery(function($) {
  var cancelWatch, navigate, watchCurrentPosition, watchToken;
  watchToken = null;
  watchCurrentPosition = function(enableHighAccuracy, next) {
    if (!navigator.geolocation) {
      return next('nogeo');
    }
    return watchToken = navigator.geolocation.watchPosition(function(data) {
      return next(null, data.coords);
    }, function(e) {
      return next(e.code);
    }, {
      enableHighAccuracy: enableHighAccuracy,
      timeout: 10 * 1024
    });
  };
  cancelWatch = function() {
    if (watchToken) {
      return navigator.geolocation.cancelWatch(watchToken);
    }
  };
  navigate = function(target) {
    $('section:visible').hide();
    return $(target).show().trigger('navigate');
  };
  $('[data-navigate]').click(function() {
    return navigate($(this).data('navigate'));
  });
  $('#locating').on('navigate', function() {
    var location, state;
    location = null;
    state = 'locating';
    $('#locating .accuracy.none').show();
    return watchCurrentPosition(true, function(err, coords) {
      var _ref, _ref1;
      if (state === 'locating') {
        if (err === 1) {
          return navigate('#denied-geo');
        }
        if (err === 'nogeo') {
          return navigate('#no-geo');
        }
        if (err) {
          return navigate('#no-gps');
        }
        if (!(location && coords.accuracy > location.accuracy)) {
          location = coords;
          $('#locating .accuracy:visible').hide();
          if (location.accuracy >= 200) {
            $('#locating .accuracy.none').show();
          }
          if ((100 <= (_ref = location.accuracy) && _ref < 200)) {
            $('#locating .accuracy.low').show();
          }
          if ((50 < (_ref1 = location.accuracy) && _ref1 < 100)) {
            $('#locating .accuracy.medium').show();
          }
          if (location.accuracy <= 50) {
            state = 'ready';
            return navigate('#hail');
          }
        }
      }
      if (state === 'ready') {
        if (coords.accuracy < 50) {
          return location = coords;
        }
      }
      if (state === 'submitted') {
        if (coords.accuracy < 50) {
          return location = coords;
        }
      }
    });
  });
  $('#denied-geo, #no-geo, #no-gps').on('navigate', function() {
    var state;
    cancelWatch();
    return state = 'no-geo';
  });
  return navigate('#locating');
});
